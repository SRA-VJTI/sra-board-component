<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SRA Board Components: include/bar_graph.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SRA Board Components
   </div>
   <div id="projectbrief">ESP-IDF component for SRA Board</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">bar_graph.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;freertos/FreeRTOS.h&quot;</code><br />
<code>#include &quot;driver/gpio.h&quot;</code><br />
<code>#include &quot;esp_log.h&quot;</code><br />
<code>#include &quot;esp_err.h&quot;</code><br />
<code>#include &quot;<a class="el" href="pin__defs_8h_source.html">pin_defs.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="motor__driver_8h_source.html">motor_driver.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for bar_graph.h:</div>
<div class="dyncontent">
<div class="center"><img src="bar__graph_8h__incl.png" border="0" usemap="#include_2bar__graph_8h" alt=""/></div>
<map name="include_2bar__graph_8h" id="include_2bar__graph_8h">
<area shape="rect" id="node8" href="pin__defs_8h.html" title="pin_defs.h" alt="" coords="388,155,471,181"/>
<area shape="rect" id="node9" href="motor__driver_8h.html" title="motor_driver.h" alt="" coords="395,80,501,107"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="bar__graph_8h__dep__incl.png" border="0" usemap="#include_2bar__graph_8hdep" alt=""/></div>
<map name="include_2bar__graph_8hdep" id="include_2bar__graph_8hdep">
<area shape="rect" id="node2" href="sra__board_8h.html" title="include/sra_board.h" alt="" coords="5,80,140,107"/>
<area shape="rect" id="node3" href="bar__graph_8c.html" title="src/bar_graph.c" alt="" coords="165,80,277,107"/>
</map>
</div>
</div>
<p><a href="bar__graph_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab10cdc6b54d4e647335eebb25dabd2f7"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar__graph_8h.html#ab10cdc6b54d4e647335eebb25dabd2f7">enable_bar_graph</a> ()</td></tr>
<tr class="memdesc:ab10cdc6b54d4e647335eebb25dabd2f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">enables the bar graph led's gpio pins  <a href="#ab10cdc6b54d4e647335eebb25dabd2f7">More...</a><br /></td></tr>
<tr class="separator:ab10cdc6b54d4e647335eebb25dabd2f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3c6552600f6d84335edd8bb6095fe3a"><td class="memItemLeft" align="right" valign="top">esp_err_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar__graph_8h.html#ae3c6552600f6d84335edd8bb6095fe3a">set_bar_graph</a> (uint8_t data)</td></tr>
<tr class="memdesc:ae3c6552600f6d84335edd8bb6095fe3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the value of bar graph LED.  <a href="#ae3c6552600f6d84335edd8bb6095fe3a">More...</a><br /></td></tr>
<tr class="separator:ae3c6552600f6d84335edd8bb6095fe3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedf9bcb0b39fed044eb70e63fc74c496"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar__graph_8h.html#aedf9bcb0b39fed044eb70e63fc74c496">bool_to_uint8</a> (bool *input_array)</td></tr>
<tr class="memdesc:aedf9bcb0b39fed044eb70e63fc74c496"><td class="mdescLeft">&#160;</td><td class="mdescRight">converts a boolean array of size 8 into 8-bit unsigned integer  <a href="#aedf9bcb0b39fed044eb70e63fc74c496">More...</a><br /></td></tr>
<tr class="separator:aedf9bcb0b39fed044eb70e63fc74c496"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aedf9bcb0b39fed044eb70e63fc74c496"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedf9bcb0b39fed044eb70e63fc74c496">&#9670;&nbsp;</a></span>bool_to_uint8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t bool_to_uint8 </td>
          <td>(</td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>input_array</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>converts a boolean array of size 8 into 8-bit unsigned integer </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">input_array</td><td>boolean input array of size 8 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint8_t returns a 8 bit number formed after combining the boolean array </dd></dl>

</div>
</div>
<a id="ab10cdc6b54d4e647335eebb25dabd2f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab10cdc6b54d4e647335eebb25dabd2f7">&#9670;&nbsp;</a></span>enable_bar_graph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t enable_bar_graph </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>enables the bar graph led's gpio pins </p>
<p>It will check for state of motor driver A and B, and accordingly init the free gpios. </p><hr/>
 <table class="doxtable">
<tr>
<th>Motor Driver A </th><th>Motor Driver B </th><th>Mode  </th></tr>
<tr>
<td>off </td><td>off </td><td>1 </td></tr>
<tr>
<td>off </td><td>parallel </td><td>2 </td></tr>
<tr>
<td>off </td><td>normal </td><td>3 </td></tr>
<tr>
<td>parallel </td><td>off </td><td>4 </td></tr>
<tr>
<td>parallel </td><td>parallel </td><td>5 </td></tr>
<tr>
<td>parallel </td><td>normal </td><td>6 </td></tr>
<tr>
<td>normal </td><td>off </td><td>7 </td></tr>
<tr>
<td>normal </td><td>parallel </td><td>8 </td></tr>
<tr>
<td>normal </td><td>normal </td><td>0 </td></tr>
</table>
<p>enabled_bar_graph_flag is set to the value of Mode accordingly.</p>
<dl class="section return"><dt>Returns</dt><dd>esp_err_t returns ESP_OK if enabled correctly, and ESP_FAIL if it failed to initialise </dd></dl>

</div>
</div>
<a id="ae3c6552600f6d84335edd8bb6095fe3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3c6552600f6d84335edd8bb6095fe3a">&#9670;&nbsp;</a></span>set_bar_graph()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">esp_err_t set_bar_graph </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the value of bar graph LED. </p>
<p>The exact working of this is a bit hard to understand, so this is example. Below are the given states of motor drivers</p>
<p>Motor Driver A: Normal Motor Driver B: Off Mode = 7, so for mode = 7, mask = bitmask[7] = 0x0F = 00001111 data = 0xAA = 10101010</p>
<p>Since, motor driver A is in normal mode and motor driver B is off, we can only use IN5 - IN8 pins of the bar graph LED</p>
<div class="fragment"><div class="line">LED1 &lt;-----&gt; Motor Driver A (IN1) ----- 0    </div><div class="line">LED2 &lt;-----&gt; Motor Driver A (IN2) ----- 0    </div><div class="line">LED3 &lt;-----&gt; Motor Driver A (IN3) ----- 0    </div><div class="line">LED4 &lt;-----&gt; Motor Driver A (IN4) ----- 0    </div><div class="line">LED5 &lt;--X--&gt; Motor Driver B (IN5) ----- 1    </div><div class="line">LED6 &lt;--X--&gt; Motor Driver B (IN6) ----- 1    </div><div class="line">LED7 &lt;--X--&gt; Motor Driver B (IN7) ----- 1    </div><div class="line">LED8 &lt;--X--&gt; Motor Driver B (IN8) ----- 1    </div></div><!-- fragment --><p>Mask ==&gt; 00001111 =&gt; 0x0F</p>
<p>Now, if data is 10101010, then even though pins IN1-IN4 are being used by motor driver, it will be set by gpio_set_level, which will crash the esp32 device. So, we check in the bitmask if the following pin is free or not, if bit is 1, it can be used, if it is 0, then it can't be used.</p>
<p>So, to achieve this we bitwise-and the mask with 0x80(10000000), if result is 0x80, then leftmost bit is 1, else it is 0. If leftmost bit is 1, means we can use this pin of bar graph, then we do the same thing with data, bitwise-and it with 0x80, to find the leftmost bit, if it is 1, the pin is set to 1, else 0. Now we left shift the data and mask variable.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>8bit binary in hexadecimal form, i.e, the pattern that is needed to be shown on the bar graph LED </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>esp_err_t returns ESP_OK </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
